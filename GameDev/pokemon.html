<!DOCTYPE HTML>
<head>
    <title>Something fancy</title>
    <style>
    	canvas{border:1px solid black;}

    </style>
</head>
<body>
  <h3>A, D or Arrow keys to move, W or space to jump</h3>
    <canvas id="canvas"></canvas>
<script>
(function() {
  var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
  window.requestAnimationFrame = requestAnimationFrame;
})();

var canvas = document.getElementById("canvas"),
  ctx = canvas.getContext("2d"),
  width = 500,
  height = 200,
  player = {
    x: 2,
    y: 1,
  },
  keys = [];

var level = [
  [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 3, 3],
  [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 3, 3],
  [0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 3, 3],
  [0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 3, 3],
  [0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 3, 3],
  [0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 3, 3],
  [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 3, 3],
  [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 3, 3],
  [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 3, 3]
];

var currentLevel = [];
function refreshLevel () {
    for (var lvlLoop = 0; lvlLoop < level.length; lvlLoop++) {
        currentLevel[lvlLoop] = level[lvlLoop].slice()
    }
}
      
refreshLevel()
      

canvas.width = width;
canvas.height = height;
var moving = false;
function update() {
  // check keys
  if (!moving) {
  if (keys[38] || keys[32] || keys[87]) {
    // up arrow or space
    if (player.y > 0) {
	refreshLevel()
    	currentLevel[player.y - 1][player.x] = 2;
    	player.y--;
    	moving = true;
    	setTimeout(function () {moving = false},300)
    }
  }
    if (keys[40] || keys[83]) {
    // down arrow or s 
    if (player.y < currentLevel.length - 1) {
    	refreshLevel()
    	currentLevel[player.y + 1][player.x] = 2
    	player.y++
    	    	moving = true;
    	setTimeout(function () {moving = false},300)
    }
    }
  if (keys[39] || keys[68]) {
    // right arrow
    if (player.x < currentLevel[player.y].length - 1) {
    	refreshLevel()
    	currentLevel[player.y][player.x + 1] = 2
    	player.x++ 
    	    	moving = true;
    	setTimeout(function () {moving = false},300)
  	}
  }
  if (keys[37] || keys[65]) {// left arrow
    if (player.x > 0) {
	refreshLevel()
    	currentLevel[player.y][player.x - 1] = 2
    	player.x--
    	moving = true;
    	setTimeout(function () {moving = false},300)
    }
  }
  }
  ctx.clearRect(0, 0, width, height);

  for (var i = 0; i < currentLevel.length; i++) {
    for (var j = 0; j < currentLevel[i].length; j++) {
      if (currentLevel[i][j] == 1) {
        ctx.beginPath();
        ctx.fillStyle = "black";
        ctx.rect(j * 20, i * 20, 20, 20);
        ctx.fill();
        ctx.closePath();
      } else if (currentLevel[i][j] == 0) {
        ctx.beginPath();
        ctx.fillStyle = "green";
        ctx.rect(j * 20, i * 20, 20, 20);
        ctx.fill();
        ctx.closePath();
      } else if (currentLevel[i][j] == 2) {
        ctx.beginPath();
        ctx.fillStyle = "red";
        ctx.rect(j * 20, i * 20, 20, 20);
        ctx.fill();
        ctx.closePath();
      } else {
        ctx.beginPath();
        ctx.fillStyle = "blue";
        ctx.rect(j * 20, i * 20, 20, 20);
        ctx.fill();
        ctx.closePath();
      }
    }
  }
  requestAnimationFrame(update);
}

document.body.addEventListener("keydown", function(e) {
  keys[e.keyCode] = true;
});

document.body.addEventListener("keyup", function(e) {
  keys[e.keyCode] = false;
});

window.addEventListener("load", function() {
  update();
});
</script>
</body>
</html>
