<!DOCTYPE HTML>
<HTML>
    <head>
        <title>Encounter Simulator</title>
        <link rel="stylesheet" href="layout.css" type="text/css" media="all" />
        <style>
            table {
                width:90%;
            }
            
            td {
                width:50%;
            }
            td input {
                width: 80%;
            }
            
            #error {
                color: #f00;
            }
            
        </style>
    </head>
    <body>
        <div class="header">
            Deep Sohelia
            <div id="hr" style="border-top: 1px solid white">
                Candidate Number: 0137 <br />
                Centre Number: 20153 <br />
                Centre Name: King Edward VI Five Ways <br />
                Date: 30/01/2015
            </div>
        </div>
        <div class="text">
            <h1>Outcome Calculator</h1>
        <hr />
        <h2>Enter two character's details</h2>
        <table>
            <tr>
                <td>
                    Enter the name of the first character<br />  
                    <input type="text" id="nameOne" />
                </td>
                <td>
                    Enter the name of the second character <br />
                    <input type="text" id="nameTwo" />
                </td>
            </tr>
            <tr>
                <td>
                    Enter the strength of the first character<br />
                    <input type="number" id="strengthOne" />
                </td>
                <td>
                    Enter the strength of the second character<br />
                    <input type="number" id="strengthTwo" />
                </td>
            </tr>
            <tr>
                <td>
                    Enter the skill of the first character<br />
                    <input type="number" id="skillOne" />
                </td>
                <td>
                    Enter the skill of the second character<br />
                    <input type="number" id="skillTwo" />
                </td>
            </tr>
        </table>
        <div id="display">Enter two characters!</div>
        <button onclick="encounter()">Test</button>
        <script>
            var output = document.getElementById("display");
            //var nm1,nm2,character1.strength,character2.strength,character1.skill,character2.skill,strDiff,preStrMod,strMod,skDiff,preSkMod,skMod;
            
            var d1;
            var d2;
            function character(name,strength,skill) {
                this.name = name;
                this.strength = strength;
                this.skill = skill;
                this.dead = false
            }
            
            var validForm;
            var reason;
            function validateForm() {
                validForm = true;
                if((nameOne.value == "") || (nameTwo.value == "")) {
                    validForm = false;
                    reason = "Name cannot be blank";
                }
                if((strengthOne.value == "") || (strengthTwo.value == "")) {
                    validForm = false;
                    reason = "Strength cannot be blank";
                }
                if((skillOne.value == "") || (skillTwo.value == "")) {
                    validForm = false;
                    reason = "Skill cannot be blank";
                }
                
                if(isNaN(parseInt(strengthOne.value,10)) || isNaN(parseInt(strengthOne.value,10))) {
                    validForm = false;
                    reason = "Strength must be a number";
                }
                if(isNaN(parseInt(skillOne.value,10)) || isNaN(parseInt(skillOne.value,10))) {
                    validForm = false;
                    reason = "Skill must be a number";
                }
                
                return validForm
            }
            
            function encounter() {
                if (validateForm()) {
                    var character1 = new character(nameOne.value,parseInt(strengthOne.value,10),parseInt(skillOne.value,10));
                    var character2 = new character(nameTwo.value,parseInt(strengthTwo.value,10),parseInt(skillTwo.value,10));
                strMod = Math.floor(Math.abs(character2.strength - character1.strength)/5);
                skMod = Math.floor(Math.abs(character2.skill - character1.skill)/5);
                d1 = Math.floor((Math.random() * 6) + 1);
                d2 = Math.floor((Math.random() * 6) + 1);
            
                if (d1 !== d2) {
                    if (d1 > d2) {
                        character1.strength += strMod;
                        character1.skill += skMod;
                        character2.strength -= strMod;
                        character2.skill -= skMod;
                    }
                    if (d1 < d2) {
                        character2.strength += strMod;
                        character2.skill += skMod;
                        character1.strength -= strMod;
                        character1.skill -= skMod;
                    }
                    if (character1.skill < 0) {
                        character1.skill = 0;
                    }
                    
                    if (character2.skill < 0) {
                        character2.skill = 0;
                    }
                    
                    if (character1.strength < 0) {
                        character1.strength = true;
                    }
                    
                    if (character2.strength < 0) {
                        character.strength = true;
                    }
                }
                }
                
                outputText = "<hr />" + character1.name + ": Dead: " + character1.dead + ". Strength: " + character1.strength + ". Skill: " + character1.skill + ". <br />" + character2.strength + ": Dead: " + character2.dead + ". Strength: " + character2.strength + ". Skill: " + character2.skill + ". <hr />";
                output.innerHTML = outputText;
                notifyMe()
            } else {
                alert("Invalid Values!")
                output.innerHTML = "<span id='error'>" + reason + "</span>"
            }
            }
            
            function notifyMe() {
            if (!Notification) {
                alert('Please us a modern version of Chrome, Firefox, Opera or Firefox.');
                return;
            }

            if (Notification.permission !== "granted")
                Notification.requestPermission();

                var notification = new Notification('New Character: ' + nm1, {
                    icon: "http:\/\/icons.iconarchive.com\/icons\/archigraphs\/assassins-creed\/128\/Swords-icon.png",
                    body: "Player " + nm1 + ": " +  " Strength: " + p1Str + " Skill: " + p1Sk + "\n\nPlayer " + nm2 + ": " + " Strength: " + p2Str + " Skill: " + p2Sk,
                });


                notification.onclick = function () {
                    window.self.focus()
                }
            }
            </script>
        </div>
            
    </body>
</HTML>
